in x: Events[Int]
in y: Events[Int]
in z: Events[Int]

def filterConst[T](x: T, cond: Events[Bool]): Events[T] = lift(cond, nil[Unit], (c: Option[Bool], nix: Option[Unit]) =>
    if getSome(c) then Some(x) else None[T]
)

def merge[T,U](x: Events[T], y: Events[U]): Events[Unit] :=
  filterConst((), default(x==x, false) || default(y==y, false))

def mergeValues[T](a: Events[T], b: Events[T]): Events[T] :=
  if default(time(a), 0) >= default(time(b), 0)
  then defaultFrom(a,b)
  else defaultFrom(b,a)

def a := merge(x,y)
def b := mergeValues(x,y)

out a
out b
