--
-- Macros
--
define prop(e1,e2) := mrv(merge(ifThen(e1, constantSignal(true)), ifThen(e2, constantSignal(false))), false)

--
-- Input
--
--define readPointerAddr := variable_values("main.c:read_idx")
define readPointerChanged := tracePointID
--define stopConsumer := function_calls("main.c:stopConsumers")
define stopConsumer := tracePointID
--define startConsumer := function_calls("main.c:startConsumers")
define startConsumer := tracePointID


--
-- Spec
--
--define readPointerChanged := changeOf(readPointerAddr)
define clk := occursAny(occursAny(stopConsumer, readPointerChanged), startConsumer)
define stop := prop(stopConsumer, clk)
define start := prop(startConsumer, clk)
define change := prop(readPointerChanged, clk)

define monitor_output := monitor("
  always(p1 implies (not(p2) until p3))",
  p1 := stop,
  p2 := change,
  p3 := start,
  clock := clk
)

-- out monitor_output
